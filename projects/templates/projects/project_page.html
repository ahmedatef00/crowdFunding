{% load static %}
{% load bootstrap4 %}
{% bootstrap_css %}
{% bootstrap_javascript jquery='full' %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Page</title>

    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"> 
    <link rel="stylesheet" type="text/css" href="{% static 'css/rating.css' %}">
</head>
<body>

    <div id="carouselExampleInterval" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
              {% for pic in pics %}
                {% if pic == pics.0 %}
                    <div class="carousel-item active">
                            <img src="/media/{{pic.pic}}" class="w-100 d-block" height="300">
                    </div>
                {% else %}
                    <div class="carousel-item">
                            <img src="/media/{{pic.pic}}" class="w-100 d-block" height="300">
                    </div>
                {% endif %}
              {% endfor %}
        </div>
        <a id="NP-icon" class="carousel-control-prev" href="#carouselExampleInterval" role="button" data-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
        </a>
        <a id="NP-icon" class="carousel-control-next" href="#carouselExampleInterval" role="button" data-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
        </a>
    </div>
    {{ project.title }}
    {{ project.details }}
    {% if donations_flag %}
        <form action="{% url 'projects:cancel_project' project.id %}" method="post">
            {% csrf_token %}
            <input type="submit" value="cancel" class="btn btn-danger">
        </form>
    {% endif %}
    
    <div style="width:auto" class="stars">
        <br>
        <h3>Your Rate </h3>
        {{user_rate}}
        <form action="">
              {% for i in '54321'|make_list %}
              <input class="star star-{{i}}" id="star-{{i}}" type="radio" name="star"
                    onchange="onRateChange({{ project.id }}, {{i}})" 
                    {% if i|add:"0" == user_rate %} 
                        checked 
                    {% endif %} />
              <label class="star star-{{i}}" for="star-{{i}}"></label>
              {% endfor%}
        </form>
    </div>

    <div style="width:auto" class="stars">
        <h3 class="card-title"> Project Rate {{ project.rating }} </h3>
        {% for i in '01234'|make_list %}
            {% if project.rating >= forloop.counter %}
                <span class="fa fa-star checked"></span>
            {% else %}
                <span class="fa fa-star "></span>
            {% endif %}
        {% endfor%}
    </div>



    <script>
        function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie != '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = jQuery.trim(cookies[i]);
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) == (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            } 
        onRateChange = (id, value) => {
                console.log(id);
                console.log(value);
                $.ajax({
                    url: `${id}/rating/${value}`, type: "POST",
                    beforeSend: function (request) { request.setRequestHeader("X-CSRFToken", 
                    getCookie('csrftoken')); },
                    dataType: 'json',
                    complete: function (data) {
                        console.log(data)
                    }
                });
            }; 
    </script>
</body>
</html>